!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.wamml=t()}}(function(){return function t(e,n,r){function o(c,u){if(!n[c]){if(!e[c]){var s="function"==typeof require&&require;if(!u&&s)return s(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+c+"'")}var a=n[c]={exports:{}};e[c][0].call(a.exports,function(t){var n=e[c][1][t];return o(n?n:t)},a,a.exports,t,e,n,r)}return n[c].exports}for(var i="function"==typeof require&&require,c=0;c<r.length;c++)o(r[c]);return o}({1:[function(t,e){e.exports=t("./src/wamml")},{"./src/wamml":9}],2:[function(t,e){"use strict";function n(t){return t[t.length-1]}function r(t,e,n){return Math.max(e,Math.min(t,n))}function o(t,e){return t+e}function i(t,e){var n=0,i=0;return null===t[0]&&(t=e.length.concat(t.slice(1))),t.map(function(t){return null===t?t=n:0===t?t=i=2*i:n=i=t,60/e.tempo*(4/r(t,1,1920))}).reduce(o,0)}function c(t){return[].concat({type:u.Begin},t,{type:u.End}).map(function(t,e){return c[t.type](t,e)})}var u=t("./syntax");c[u.Begin]=function(){return function(t,e){return e.tempo=120,e.octave=5,e.quantize=6,e.length=[4],e.pendings=[],e.loopStack=[],e.infLoopIndex=null,e.infLoopWhen=t,t}},c[u.End]=function(){return function(t,e){null!==e.infLoopIndex?e.infLoopWhen!==t&&(e.index=e.infLoopIndex):e.postMessage({type:"end",when:t},{bubble:!0})}},c[u.Note]=function(t){return function(e,n){n.pendings.splice(0).forEach(function(t){t(n)});var r=i(t.length,n),o=r*(n.quantize/8);return t.number.forEach(function(t,r){function i(t,r){n.postMessage({type:"sched",when:e+o+(r||0),callback:t},{"private":!0})}var c=12*n.octave+t+12;n.postMessage({type:"note",when:e,midi:c,duration:o,noteOff:i,chordIndex:r})}),e+r}},c[u.Octave]=function(t){return function(e,n){n.pendings.push(function(e){e.octave=r(t.value,0,8)})}},c[u.OctaveShift]=function(t){return function(e,n){n.pendings.push(function(e){var n=e.octave+t.direction*t.value;e.octave=r(n,0,8)})}},c[u.Length]=function(t){return function(e,n){n.pendings.push(function(e){e.length=t.length})}},c[u.Quantize]=function(t){return function(e,n){n.pendings.push(function(e){e.quantize=r(t.value,0,8)})}},c[u.Tempo]=function(t){return function(e,n){n.pendings.push(function(e){e.tempo=r(t.value,1,511)})}},c[u.InfLoop]=function(t,e){return function(t,n){n.infLoopIndex=e,n.infLoopWhen=t}},c[u.LoopBegin]=function(t,e){return function(n,o){o.loopStack.push([r(t.value,1,999),e,null])}},c[u.LoopExit]=function(){return function(t,e){var r=n(e.loopStack);r[0]<=1&&null!==r[2]&&(e.index=r[2])}},c[u.LoopEnd]=function(t,e){return function(t,r){var o=n(r.loopStack);null===o[2]&&(o[2]=e),o[0]-=1,o[0]>0?r.index=o[1]:r.loopStack.pop()}},e.exports=function(t){return c(t)}},{"./syntax":7}],3:[function(t,e){"use strict";function n(){this._callbacks={}}n.prototype.hasListeners=function(t){return this._callbacks.hasOwnProperty(t)},n.prototype.listeners=function(t){return this.hasListeners(t)?this._callbacks[t].slice():[]},n.prototype.on=function(t,e){return this.hasListeners(t)||(this._callbacks[t]=[]),this._callbacks[t].push(e),this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(t,e){function n(r){this.off(t,n),e.call(this,r)}return n.listener=e,this.on(t,n),this},n.prototype.off=function(t,e){return"undefined"==typeof e?"undefined"==typeof t?this._callbacks={}:this.hasListeners(t)&&delete this._callbacks[t]:this.hasListeners(t)&&(this._callbacks[t]=this._callbacks[t].filter(function(t){return!(t===e||t.listener===e)})),this},n.prototype.removeListener=n.prototype.off,n.prototype.removeAllListeners=n.prototype.off,n.prototype.emit=function(t,e){this.listeners(t).forEach(function(t){t.call(this,e)},this)},e.exports=n},{}],4:[function(t,e){"use strict";e.exports=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],5:[function(t,e){"use strict";function n(t,e){return Array.isArray(e)?Array.prototype.push.apply(t,e):e&&t.push(e),t}function r(t,e){return null===t?e:t}function o(t){function e(){return p>h}function n(){return t.charAt(h)}function r(){return t.charAt(h++)}function o(e){return e.test?e.test(t.charAt(h)):t.charAt(h)===e}function i(t){o(t)||f(),h+=1}function c(e){var n=e.exec(t.substr(h));return n&&0===n.index?(n=n[0],h+=n.length):n=null,n}function u(){for(;e();){var n=t.charCodeAt(h),r=t.charCodeAt(h+1);if(32===n||9===n)h+=1;else if(10===n)h+=1,l+=1,d=h;else if(47===n&&47===r)s();else{if(47!==n||42!==r)break;a()}}}function s(){for(h+=2;e();)if(10===t.charCodeAt(h++)){l+=1,d=h;break}}function a(){var n=1;for(h+=2;e();){var r=t.charCodeAt(h++),o=t.charCodeAt(h);if(10===r)l+=1,d=h;else if(47===r&&42===o)h+=1,++n;else if(42===r&&47===o&&(h+=1,0===--n))return void(h+=1)}f()}function f(){var t=n(),e="Unexpected token"+(t?": '"+t+"'":" ILLEGAL"),r=new SyntaxError(e);throw r.index=h,r.lineNumber=l,r.column=h-d+(t?1:0),r}t=String(t);var p=t.length,h=0,l=p?1:0,d=0;return{hasNext:e,peek:n,next:r,match:o,expect:i,scan:c,forward:u,throwUnexpectedToken:f}}function i(t){function e(e,n){for(;;){if(t.forward(),!t.hasNext()||t.match(e))break;n()}}function o(e){return{c:0,d:2,e:4,f:5,g:7,a:9,b:11}[t.next()]+u()+e}function i(){for(var e=(t.scan(/\.+/)||"").length,n=new Array(e),r=0;e>r;r++)n[r]=0;return n}function u(){return t.match("+")?(t.next(),1):t.match("-")?(t.next(),-1):0}function s(t){return n([r(a(/\d+/),t)].concat(i()),f())}function a(e){var n=t.scan(e);return null!==n?+n:null}function f(){return t.forward(),t.match("^")?(t.next(),s(null)):null}function p(){return{type:c.Note,number:[o(0)],length:s(null)}}function h(){t.expect("(");var n=[],r=0;return e(")",function(){switch(t.peek()){case"c":case"d":case"e":case"f":case"g":case"a":case"b":n.push(o(r));break;case"<":t.next(),r+=12;break;case">":t.next(),r-=12;break;default:t.throwUnexpectedToken()}}),t.expect(")"),{type:c.Note,number:n,length:s(null)}}function l(){return t.expect("r"),{type:c.Note,number:[],length:s(null)}}function d(){return t.expect("o"),{type:c.Octave,value:r(a(/\d+/),5)}}function x(e){return t.expect(/<|>/),{type:c.OctaveShift,direction:0|e,value:r(a(/\d+/),1)}}function v(){return t.expect("l"),{type:c.Length,length:s(4)}}function y(){return t.expect("q"),{type:c.Quantize,value:r(a(/\d+/),6)}}function m(){return t.expect("t"),{type:c.Tempo,value:r(a(/\d+(\.\d+)?/),120)}}function g(){return t.expect("$"),{type:c.InfLoop}}function _(){t.expect("[");var r=[{type:c.LoopBegin}];return e(/\||\]/,function(){n(r,k())}),n(r,b()),t.expect("]"),r.push({type:c.LoopEnd}),r[0].value=a(/\d+/)||2,r}function b(){var r=[];return t.match("|")&&(t.next(),r.push({type:c.LoopExit}),e("]",function(){n(r,k())})),r}function k(){switch(t.peek()){case"c":case"d":case"e":case"f":case"g":case"a":case"b":return p();case"(":return h();case"r":return l();case"o":return d();case"<":return x(1);case">":return x(-1);case"l":return v();case"q":return y();case"t":return m();case"$":return g();case"[":return _()}t.throwUnexpectedToken()}function L(){var r=[];return e("",function(){var o=[];e(";",function(){n(o,k())}),r.push(o),t.match(";")&&t.next()}),r}return L()}var c=t("./syntax");e.exports=function(t){return i(o(t))}},{"./syntax":7}],6:[function(t,e){"use strict";function n(t,e){u.call(this),this.audioContext=t,this.tracks=i(e).map(c).map(function(t){return new s(this,t)},this),this._ended=0,this._node=null,this._currentTime=0,this._currentTimeIncr=0}var r=512,o=t("./extend"),i=t("./parse"),c=t("./compile"),u=t("./emitter"),s=t("./track");o(n,u),n.prototype.start=function(){this.stop();var t=this.audioContext.currentTime,e=r/this.audioContext.sampleRate;return this.tracks.forEach(function(n){n._init(t,e)},this),this._node=this.audioContext.createScriptProcessor(r,1,1),this._node.onaudioprocess=this._process.bind(this),this._node.connect(this.audioContext.destination),this},n.prototype.stop=function(){return this._node&&this._node.disconnect(),this._node=null,this},n.prototype.onmessage=function(t){t&&"end"===t.type&&(this._ended+=1,this.tracks.length<=this._ended&&this.emit("end",t))},n.prototype._process=function(){var t=this.audioContext.currentTime;this.tracks.forEach(function(e){e._process(t)})},e.exports=n},{"./compile":2,"./emitter":3,"./extend":4,"./parse":5,"./track":8}],7:[function(t,e){"use strict";e.exports={Begin:0,Note:1,Octave:2,OctaveShift:3,Length:4,Quantize:5,Tempo:6,InfLoop:7,LoopBegin:8,LoopExit:9,LoopEnd:10,End:99}},{}],8:[function(t,e){"use strict";function n(t,e){return t[o]-e[o]}function r(t,e){u.call(this),this._parent=t,this._nodes=e,this._state={index:0,postMessage:this.onmessage.bind(this)},this._sched=[],this._currentTimeIncr=0}var o=0,i=1,c=t("./extend"),u=t("./emitter");c(r,u),r.prototype._init=function(t,e){this._currentTimeIncr=e;var n=function(t,e){for(var r=t+this._currentTimeIncr,o=this._nodes;e.index<o.length&&r>t;){var i=o[e.index](t,e);e.index+=1,i&&(t=i)}e.index<o.length&&this.sched(t,n)}.bind(this);n(t,this._state)},r.prototype._process=function(t){for(var e=t+this._currentTimeIncr,n=this._sched,r=this._state;n.length&&n[0][o]<e;){var c=n.shift();c[i](c[o],r)}},r.prototype.onmessage=function(t,e){e=e||{},"sched"===t.type&&this.sched(t.when,t.callback),e.private||this.emit(t.type,t),e.bubble&&this._parent&&this._parent.onmessage(t)},r.prototype.sched=function(t,e){return this._sched.push([t,e]),this._sched.sort(n),this},e.exports=r},{"./emitter":3,"./extend":4}],9:[function(t,e){"use strict";var n=t("./sequencer");e.exports={version:"0.1.0",Sequencer:n}},{"./sequencer":6}]},{},[1])(1)});